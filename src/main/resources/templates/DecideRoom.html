<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Decide Room Page</title>
  <link rel="stylesheet" href="../static/DecideRoom.css">
<!--  <style>-->
<!--    .design { border: 1px solid #ddd; padding: 10px; border-radius: 5px; text-align: center; margin-bottom: 15px; }-->
<!--    img { width: 300px; height: auto; border-radius: 5px; }-->
<!--    button {-->
<!--      margin-top: 10px; padding: 8px 12px; background-color: #007bff; color: #fff;-->
<!--      border: none; border-radius: 5px; cursor: pointer;-->
<!--    }-->
<!--  </style>-->
</head>
<body><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Decide Room</title>
<!--  <style>-->
<!--    body { font-family: Arial, sans-serif; margin: 20px; }-->
<!--    .gallery { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center;}-->
<!--    .room { border: 1px solid #ddd; padding: 10px; border-radius: 5px; text-align: center;-->
<!--      box-shadow: 0 4px 8px rgba(0,0,0,0.2);}-->
<!--    img { width: 600px; height: 400px; border-radius: 10px; margin-bottom: 10px}-->
<!--    button {-->
<!--      margin-top: 10px; padding: 8px 12px; background-color: #007bff; color: #fff;-->
<!--      border: none; border-radius: 5px; cursor: pointer;-->
<!--    }-->
<!--    button:hover {-->
<!--      background-color: #0056b3; /* 按鈕懸停效果 */-->
<!--    }-->
<!--  </style>-->
</head>
<body>
<h1>Available Rooms</h1>
<div id="loading" style="display: none;">Loading...</div>
<div class="gallery" id="roomContainer"></div>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const params = new URLSearchParams(window.location.search);
    const startDate = params.get('startDate');
    const endDate = params.get('endDate');
    const numberOfGuests = params.get('numberOfGuests');

    const roomContainer = document.getElementById('roomContainer');
    const loading = document.getElementById('loading');

    try {
      loading.style.display = 'block'; // 顯示加載中提示

      // 構建後端請求 URL
      const url = 'http://localhost:8080/api/rooms/check-availability';
      const response = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          startDate: startDate,
          endDate: endDate,
          numberOfGuests: numberOfGuests
        })
      });

      if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`Error ${response.status}: ${errorText}`);
      }

      const rooms = await response.json();
      loading.style.display = 'none';

      if (!rooms || rooms.length === 0) {
        roomContainer.innerHTML = '<p>No rooms available for the selected dates.</p>';
        return;
      }

      displayRooms(rooms, startDate, endDate, numberOfGuests);

    } catch (error) {
      console.error('Error fetching room data:', error);
      alert(`Failed to load rooms: ${error.message}`);
      loading.style.display = 'none';
    }
  });

  function displayRooms(rooms, startDate, endDate, numberOfGuests) {
    const roomContainer = document.getElementById('roomContainer');
    roomContainer.innerHTML = ''; // 清空現有內容

    rooms.forEach(room => {
      const roomCard = `
        <div class="room">
          <img src="${room.imageUrl}" alt="${room.roomType}">
          <h3>${room.roomType}</h3>
          <p>Max Occupancy: ${room.maxOccupancy}</p>
          <p>Price: $${room.price} / night</p>
          <button onclick="selectRoom('${room.id}', '${room.roomType}', ${room.price}, ${room.maxOccupancy}, '${room.imageUrl}', '${startDate}', '${endDate}', ${numberOfGuests})">
            Select This Room
          </button>
        </div>
      `;
      roomContainer.insertAdjacentHTML('beforeend', roomCard);
    });
  }

  function selectRoom(id, roomType, price, maxOccupancy, imageUrl, startDate, endDate, numberOfGuests) {
    const queryParams = new URLSearchParams({
      roomId: id,
      roomType: roomType,
      price: price,
      maxOccupancy: maxOccupancy,
      imageUrl: imageUrl,
      startDate: startDate,
      endDate: endDate,
      numberOfGuests: numberOfGuests
    }).toString();

    window.location.href = `EnterInfo.html?${queryParams}`;
  }
</script>
</body>
</html>
</body>
</html>
